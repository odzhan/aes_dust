
//
// Test unit for aes128_ofb.c
//

#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

#include "aes128_ofb.h"

//
// Test vectors for AES-128 in OFB mode.
//
// echo -n -e '\x6b\xc1\xbe\xe2\x2e\x40\x9f\x96\xe9\x3d\x7e\x11\x73\x93\x17\x2a' | openssl enc -e -aes-128-ofb -nosalt -A -K 
// 2B7E151628AED2A6ABF7158809CF4F3C -iv 000102030405060708090A0B0C0D0E0F | xxd -i
uint8_t 
ofb_key[2][16]={
{  0x2b,0x7e,0x15,0x16,0x28,0xae,0xd2,0xa6,0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c},
  {0x1f,0x35,0x2c,0x07,0x3b,0x61,0x08,0xd7,0x2d,0x98,0x10,0xa3,0x09,0x14,0xdf,0xf4}};

uint8_t 
ofb_iv[2][16]={
{ 0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f},
{ 0xb7,0xbf,0x3a,0x5d,0xf4,0x39,0x89,0xdd,0x97,0xf0,0xfa,0x97,0xeb,0xce,0x2f,0x4a}};

uint8_t 
ofb_plain[2][16]={
{ 0x6b,0xc1,0xbe,0xe2,0x2e,0x40,0x9f,0x96,0xe9,0x3d,0x7e,0x11,0x73,0x93,0x17,0x2a},
{ 0xae,0x2d,0x8a,0x57,0x1e,0x03,0xac,0x9c,0x9e,0xb7,0x6f,0xac,0x45,0xaf,0x8e,0x51}};

uint8_t 
ofb_cipher[2][16]={
{ 0x3b,0x3f,0xd9,0x2e,0xb7,0x2d,0xad,0x20,0x33,0x34,0x49,0xf8,0xe8,0x3c,0xfb,0x4a},
{ 0x7a,0x47,0x2d,0xe3,0x24,0x91,0xf9,0x2b,0x4b,0x2c,0x93,0x17,0x28,0x3b,0xb5,0xd4}};

int
main(void) {
    aes128_ctx c;
    u8         buf[AES_BLK_LEN], key[AES_KEY_LEN];
    u32        i, equ;
    
    puts ("\n**** AES-128 OFB Test ****\n");
    
    for (i = 0; i < 2; i++) {
        memcpy(buf, ofb_plain[i], AES_BLK_LEN);
        memcpy(key, ofb_key[i], AES_KEY_LEN);
        memcpy(c.iv, ofb_iv[i], AES_IV_LEN);

        printf("\n Key        : ");
        for (int i=0; i<16; i++) printf(" %02x", key[i]);
        
        printf("\n Plaintext  : ");
        for (int i=0; i<16; i++) printf(" %02x", buf[i]);

        aes128_init_ctx(&c);
        aes128_set_key(&c, key);
        aes128_ofb_encrypt(&c, buf, sizeof(buf));
        
        printf("\n Encrypted  : ");
        for (int i=0; i<16; i++) printf(" %02x", buf[i]);
        
        aes128_ofb_decrypt(&c, buf, sizeof(buf));
        
        printf("\n Decrypted  : ");
        for (int i=0; i<16; i++) printf(" %02x", buf[i]);
        
        equ = (memcmp(buf, ofb_plain[i], AES_BLK_LEN)==0);
        printf("\n Test #%d : %s\n", (i+1), equ ? "OK" : "FAILED");
    }
    return 0;
}
