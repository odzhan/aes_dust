
//
// Test unit for aes128_cbc.c
//

#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

#include "aes128_cbc.h"

//
// Test vectors for AES-128 in CBC mode.
//
u8 
cbc_key[2][AES_KEY_LEN] = {
{ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f },
{ 0x2B, 0x7E, 0x15, 0x16, 0x28, 0xAE, 0xD2, 0xA6, 0xAB, 0xF7, 0x15, 0x88, 0x09, 0xCF, 0x4F, 0x3C }};

u8 
cbc_iv[2][AES_IV_LEN] = {
{ 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff },
{ 0x76, 0x49, 0xAB, 0xAC, 0x81, 0x19, 0xB2, 0x46, 0xCE, 0xE9, 0x8E, 0x9B, 0x12, 0xE9, 0x19, 0x7D }};

u8 
cbc_plain[2][AES_BLK_LEN] = {
{ 0x6B, 0xC1, 0xBE, 0xE2, 0x2E, 0x40, 0x9F, 0x96, 0xE9, 0x3D, 0x7E, 0x11, 0x73, 0x93, 0x17, 0x2A },
{ 0xAE, 0x2D, 0x8A, 0x57, 0x1E, 0x03, 0xAC, 0x9C, 0x9E, 0xB7, 0x6F, 0xAC, 0x45, 0xAF, 0x8E, 0x51 }};

u8 
cbc_cipher[2][AES_BLK_LEN] = {
{ 0x13, 0xd3, 0x16, 0x3c, 0x67, 0x43, 0x0d, 0xf7, 0xca, 0xad, 0x77, 0x4b, 0xb3, 0xd3, 0xea, 0xcb },
{ 0x50, 0x86, 0xcb, 0x9b, 0x50, 0x72, 0x19, 0xee, 0x95, 0xdb, 0x11, 0x3a, 0x91, 0x76, 0x78, 0xb2 }};

int
main(void) {
    aes128_ctx c;
    u8 buf[AES_BLK_LEN], key[AES_KEY_LEN];
    u32 i, equ;
    
    puts ("\n**** AES-128 CBC Test ****\n");
    
    for (i=0; i<2; i++) {
        memcpy(buf, cbc_plain[i], AES_BLK_LEN);
        memcpy(key, cbc_key[i], AES_KEY_LEN);
        memcpy(c.iv, cbc_iv[i], AES_IV_LEN);

        printf("\n Key        : ");
        for (int i=0; i<16; i++) printf(" %02x", key[i]);
        
        printf("\n Plaintext  : ");
        for (int i=0; i<16; i++) printf(" %02x", buf[i]);

        aes128_init_ctx(&c);
        aes128_set_key(&c, key);
        aes128_cbc_encrypt(&c, buf, sizeof(buf));
        
        printf("\n Encrypted  : ");
        for (int i=0; i<16; i++) printf(" %02x", buf[i]);
        
        aes128_cbc_decrypt(&c, buf, sizeof(buf));
        
        printf("\n Decrypted  : ");
        for (int i=0; i<16; i++) printf(" %02x", buf[i]);
        
        equ = (memcmp(buf, cbc_plain[i], AES_BLK_LEN)==0);
        printf("\n Test #%d : %s\n", (i+1), equ ? "OK" : "FAILED");
    }
    return 0;
}
